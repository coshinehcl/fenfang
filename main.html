<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>房间分配</title>
    <style>
        body,html {
            font-size: 18px;
            margin:0;
            padding: 0;;
        }
        .form {
            padding:20px;
            width: 100vw;
            box-sizing: border-box;
        }
        .form .item,.form .item-btn {
            display: flex;
            width: 100%;
            margin-bottom: 10px;
            align-items: center;
            justify-content: center;
        }
        .form .item label {
            width: 100px;
        }
        .form .item input {
            flex:1;
            height: 32px;
            outline: none;
            border-radius: 10000px;
            border:1px solid #333;
            font-size: 16px;
            padding: 0 10px;
        }
        .form .item input:focus {
            border-color: blue;
        }
        .form .item-btn button {
            height: 32px;
            border-radius: 10000px;
            border:1px solid #333;
            width: 200px;
            font-size: 16px;
            color:#333;
        }
        .form-result {
            width: 100vw;
            box-sizing: border-box;
            display: flex;
            flex-wrap:wrap;
            margin-bottom: 40px;
            justify-content: space-around;
            align-items: center;
        }
        .form-result .result-item {
            width: calc(50% - 10px);
            box-sizing: border-box;
            border:1px solid #dfe1e5;
            border-radius: 8px;
            margin-bottom: 10px;
            overflow: hidden;
        }
        .form-result .result-item .result-item-header {
            display: flex;
            justify-content: space-between;
            padding:4px;
            border-bottom: 1px solid #dfe1e5;
        }
        .form-result .distribute_total {
            color:#FF0033;
        }
        .bold {
            font-weight: bold;
            font-size: 1.1;
        }
        .info {
            color: #999;
        }
        .content-item {
            display: flex;
            justify-content: space-between;
            padding:2px 4px;
            color:var(--color);
        }
        .result-tip {
            font-size: 14px;
            color: #999;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .result-tip::before {
            content: '';
            display: inline-block;
            width: 20vw;
            height: 1px;
            background-color: #999;
            margin-right: 6px;
        }
        .result-tip::after {
            content: '';
            display: inline-block;
            width: 20vw;
            height: 1px;
            background-color: #999;
            margin-left: 6px;
        }
    </style>
</head>
<body>
    <div class="form">
        <div class="item">
            <label for="od">OD房</label>
            <input id="od" type="number" placeholder="0">
        </div>
        <div class="item">
            <label for="od_sc">OD双床房</label>
            <input id="od_sc" type="number" placeholder="0">
        </div>
        <div class="item">
            <label for="vd">VD房</label>
            <input id="vd" type="number" placeholder="0">
        </div>
        <div class="item">
            <label for="gy">隔夜房</label>
            <input id="gy" type="number" placeholder="0">
        </div>
        <div class="item">
            <label for="num">上班人数</label>
            <input id="num" type="number" placeholder="0">
        </div>
        <div class="item-btn">
            <button class="bold">分配</button>
        </div>
    </div>
    <div class="form-result"></div>
</body>
<script>
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]]; // ES6 的数组解构赋值，方便交换元素
        }
        return array;
    }
    function distributeIntegers(totalItems, numPeople,reverse = false) {
        const base = Math.floor(totalItems / numPeople);
        const remainder = totalItems % numPeople;
        const distribution = new Array(numPeople).fill(base); // 创建一个数组，并用基数填充
        for (let i = 0; i < remainder; i++) {
            distribution[i]++; // 将余数依次加到前几个人的分配中
        }
        if(reverse) {
            return distribution.reverse();
        }
        return distribution;
    }
    const btn = document.querySelector('.form button');
    const items = document.querySelectorAll('.form .item');
    function disPlayDistributeResult(membersRoom) {
        // 移除老结果数据
        const formResult = document.querySelector('.form-result');
        while(formResult.firstChild) {
            formResult.removeChild(formResult.firstChild);
        }
        // 显示新结果数据
        // 编号打乱，确保分配到实际人，会更公平
        const memberIdArr = new Array(membersRoom.length).fill('').map((_,index) => index);// [0,1,2,..]
        const randomMenberIdArr = shuffleArray(memberIdArr); // [2,3,1,..]
        let busyZindex = 0; // 是否比较忙，忙的程度是什么
        randomMenberIdArr.forEach((menberId,index) => {
            const nemberResult = document.createElement('div');
            const roomsItem = membersRoom.find(i => i.id === menberId);
            const resultHeader = [
                `<div class="info">人员${index + 1}</div>`,
                `<div class="info">房间总数&nbsp;<span class="distribute_total bold">${roomsItem.total}</span></div>`,
            ].join('');
            const resultContent = [
                `<div class="content-item" style="--color:#9900FF"><span>OD双床房</span><span class="bold">${roomsItem.detail.od_sc}</span></div>`,
                `<div class="content-item" style="--color:#660099"><span>OD单床房</span><span class="bold">${roomsItem.detail.od_dc}</span></div>`,
                `<div class="content-item" style="--color:#3366FF"><span>VD房</span><span class="bold">${roomsItem.detail.vd}</span></div>`,
                `<div class="content-item" style="--color:#000000"><span>隔夜房</span><span class="bold">${roomsItem.detail.gy}</span></div>`,
            ].join('');
            const roomActualNum = roomsItem.detail.od_sc + roomsItem.detail.od_dc + roomsItem.detail.vd; // 统计真实要打扫的房间数量
            if(roomActualNum > 20) {
                busyZindex +=1;
            } else {
                busyZindex -=1;
            }
            nemberResult.innerHTML = [
                `<div class="result-item-header">${resultHeader}</div>`,
                `<div class="result-item-content">${resultContent}</div>`,
            ].join('');
            nemberResult.className = 'result-item'
            formResult.appendChild(nemberResult)
        });
        // 文案提醒
        const tipNode = document.createElement('div');
        tipNode.className = "result-tip";
        tipNode.innerText = busyZindex > 0 ? '今天房间较多，辛苦你啦~' : '今天房间较少，抓好卫生';
        formResult.appendChild(tipNode);
        // 庶民 + 日期
        const dateNode = document.createElement('div');
        dateNode.className = "result-tip";
        dateNode.innerText = `分配日期： ${new Date().toLocaleDateString()}`
        formResult.appendChild(dateNode);
        // 滚动到结果区域
        formResult.scrollIntoView({behavior:'smooth',block:'center'});
    }
    btn.addEventListener('click',()=> {
        const formValues = {};
        Array.from(items).forEach(_item => {
            const input = _item.querySelector('input');
            formValues[input.id] = Number(input.value || 0);
        })
        if(!formValues.od || !formValues.num) {
            alert('确保OD房和上班人数有值')
            return;
        }
        if(formValues.od < formValues.od_sc) {
            alert('OD房比OD双床少，检查数据准确性')
            return;
        }
        // 生成用户编号及房间分配情况
        // 后续添加进来，这个数组的total要多到少(及时排序)，后续添加进来的时候从少到多，确保各项的total接近
        const membersRoom = new Array(formValues.num).fill('').map((i,index) => ({
            id:index,
            total:0,
            detail:{}
        }))
        function updateMenbersRoom(arr,field){
            // 我们先更新membersRoom排序(total:多到少)
            membersRoom.sort((l,r) => {
                if(l.total < r.total) {
                    return 1;
                } else if(l.total === r.total) {
                    return 0;
                } else {
                    return -1
                }
            })
            // 再更新数据进来(arr:少到多)
            membersRoom.forEach((i,index) => {
                i.total += arr[index];
                i.detail[field] = arr[index];
            })
        }
        // OD-双床房
        const od_scDistribute = distributeIntegers(formValues.od_sc, formValues.num);
        updateMenbersRoom(od_scDistribute,'od_sc')
        // OD-单床
        const od_dcDistribute = distributeIntegers(formValues.od - formValues.od_sc, formValues.num,true);
        updateMenbersRoom(od_dcDistribute,'od_dc')
        // VD房
        const vdDistribute = distributeIntegers(formValues.vd, formValues.num,true);
        updateMenbersRoom(vdDistribute,'vd')
        // 隔夜房(隔夜房需要放在最后)
        const gyDistribute = distributeIntegers(formValues.gy, formValues.num,true);
        updateMenbersRoom(gyDistribute,'gy')
        // 显示结果
        disPlayDistributeResult(membersRoom);
    })
</script>
</html>